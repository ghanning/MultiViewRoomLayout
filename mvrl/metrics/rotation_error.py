import numpy as np

from ..cuboid import Cuboid

ROTATIONAL_SYMMETRIES = np.array(
    [
        [[-1.0, -0.0, -0.0], [-0.0, -0.0, -1.0], [-0.0, -1.0, -0.0]],
        [[-0.0, -1.0, -0.0], [-1.0, -0.0, -0.0], [-0.0, -0.0, -1.0]],
        [[-0.0, -0.0, -1.0], [-0.0, -1.0, -0.0], [-1.0, -0.0, -0.0]],
        [[-1.0, -0.0, -0.0], [-0.0, -1.0, -0.0], [0.0, 0.0, 1.0]],
        [[-0.0, -1.0, -0.0], [-0.0, -0.0, -1.0], [1.0, 0.0, 0.0]],
        [[-0.0, -0.0, -1.0], [-1.0, -0.0, -0.0], [0.0, 1.0, 0.0]],
        [[-1.0, -0.0, -0.0], [0.0, 1.0, 0.0], [-0.0, -0.0, -1.0]],
        [[-0.0, -1.0, -0.0], [0.0, 0.0, 1.0], [-1.0, -0.0, -0.0]],
        [[-0.0, -0.0, -1.0], [1.0, 0.0, 0.0], [-0.0, -1.0, -0.0]],
        [[-1.0, -0.0, -0.0], [0.0, 0.0, 1.0], [0.0, 1.0, 0.0]],
        [[-0.0, -1.0, -0.0], [1.0, 0.0, 0.0], [0.0, 0.0, 1.0]],
        [[-0.0, -0.0, -1.0], [0.0, 1.0, 0.0], [1.0, 0.0, 0.0]],
        [[1.0, 0.0, 0.0], [-0.0, -1.0, -0.0], [-0.0, -0.0, -1.0]],
        [[0.0, 1.0, 0.0], [-0.0, -0.0, -1.0], [-1.0, -0.0, -0.0]],
        [[0.0, 0.0, 1.0], [-1.0, -0.0, -0.0], [-0.0, -1.0, -0.0]],
        [[1.0, 0.0, 0.0], [-0.0, -0.0, -1.0], [0.0, 1.0, 0.0]],
        [[0.0, 1.0, 0.0], [-1.0, -0.0, -0.0], [0.0, 0.0, 1.0]],
        [[0.0, 0.0, 1.0], [-0.0, -1.0, -0.0], [1.0, 0.0, 0.0]],
        [[1.0, 0.0, 0.0], [0.0, 0.0, 1.0], [-0.0, -1.0, -0.0]],
        [[0.0, 1.0, 0.0], [1.0, 0.0, 0.0], [-0.0, -0.0, -1.0]],
        [[0.0, 0.0, 1.0], [0.0, 1.0, 0.0], [-1.0, -0.0, -0.0]],
        [[1.0, 0.0, 0.0], [0.0, 1.0, 0.0], [0.0, 0.0, 1.0]],
        [[0.0, 1.0, 0.0], [0.0, 0.0, 1.0], [1.0, 0.0, 0.0]],
        [[0.0, 0.0, 1.0], [1.0, 0.0, 0.0], [0.0, 1.0, 0.0]],
    ]
)


def rotation_error(cuboid1: Cuboid, cuboid2: Cuboid) -> float:
    """! Compute the rotation error between two cuboids.

    @param cuboid1, cuboid2 The cuboids.
    @return The rotation error in radians.
    """
    dR = cuboid1.R[None].transpose(0, 2, 1) @ (ROTATIONAL_SYMMETRIES @ cuboid2.R[None])
    cos = np.clip((np.trace(dR, axis1=1, axis2=2) - 1.0) / 2.0, -1.0, 1.0)
    dr = np.abs(np.arccos(cos))
    return np.min(dr)
